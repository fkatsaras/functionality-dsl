// =============================================================================
// INBOUND WEBSOCKET - MULTI-SOURCE COMPOSITE
// Demonstrates: Aggregating multiple external WebSocket sources
// Each source updates independently, composite maintains latest from each
// =============================================================================

Server InboundComposite
  host: "localhost"
  port: 8080
  cors: "*"
  loglevel: debug
end

// -----------------------------------------------------------------------------
// Sources: Multiple external WebSocket feeds
// -----------------------------------------------------------------------------
Source<WS> PriceStreamA
  channel: "ws://dummy:9001/ws/price/btc"
  operations: [subscribe]
end

Source<WS> PriceStreamB
  channel: "ws://dummy:9001/ws/price/eth"
  operations: [subscribe]
end

Source<WS> PriceStreamC
  channel: "ws://dummy:9001/ws/price/sol"
  operations: [subscribe]
end

// -----------------------------------------------------------------------------
// Base Entities: Raw data from each WS source
// -----------------------------------------------------------------------------
Entity BTCTick
  flow: inbound
  source: PriceStreamA
  attributes:
    - symbol: string;
    - price: number;
    - volume: number;
    - timestamp: integer;
end

Entity ETHTick
  flow: inbound
  source: PriceStreamB
  attributes:
    - symbol: string;
    - price: number;
    - volume: number;
    - timestamp: integer;
end

Entity SOLTick
  flow: inbound
  source: PriceStreamC
  attributes:
    - symbol: string;
    - price: number;
    - volume: number;
    - timestamp: integer;
end

// -----------------------------------------------------------------------------
// Composite Entity: Aggregates all price feeds
// Updates whenever ANY source pushes new data
// Maintains latest value from each source
// -----------------------------------------------------------------------------
Entity CryptoDashboard(BTCTick, ETHTick, SOLTick)
  flow: inbound
  attributes:
    - btc_price: number = BTCTick.price;
    - eth_price: number = ETHTick.price;
    - sol_price: number = SOLTick.price;
    - total_volume: number = BTCTick.volume + ETHTick.volume + SOLTick.volume;
    - btc_dominance: number = round(BTCTick.price / (BTCTick.price + ETHTick.price + SOLTick.price) * 100, 1);
  access: public
end

// Generated WebSocket endpoints:
// ws://localhost:8080/ws/btctick          - Raw BTC data
// ws://localhost:8080/ws/ethtick          - Raw ETH data
// ws://localhost:8080/ws/soltick          - Raw SOL data
// ws://localhost:8080/ws/cryptodashboard  - Aggregated dashboard
//
// CryptoDashboard pushes to clients whenever ANY of the 3 sources updates
