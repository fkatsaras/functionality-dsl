Server WikiLive
  host: "localhost"
  port: 8080
  cors: "http://localhost:3000"
  loglevel: debug
end

// --- External WS feed ------------------------------------------
Source<WS> WikiMonEN
  channel: "wss://wikimon.hatnote.com/en/"
  publish:
    type: object
    message: WikiEdit
end

// --- Raw entity ------------------------------------------------
// Raw snapshot from the WS frame (map exact keys)
Entity WikiEdit
  attributes:
    - action: string;
    - change_size: integer;
    - flags: object?;
    - page_namespace: integer?;
    - page_title: string;
    - user: string;
    - server_name: string;
end

// --- Computed entity -------------------------------------------
Entity EditGauge(WikiEdit)
  attributes:
    - edit_size_abs: integer = WikiEdit.change_size;
end

// --- Internal endpoints -----------------------------------------
APIEndpoint<WS> EditGaugeStream
  channel: "/api/wiki/edits"
  publish:
    type: object
    message: EditGauge
end

APIEndpoint<WS> WikiEditsStream
  channel: "/api/wiki/edits/feed"
  publish:
    type: object
    message: WikiEdit
end

// --- Components -------------------------------------------------
Component<Gauge> LiveEditSize
  endpoint: EditGaugeStream
  value: data.edit_size_abs
  min: 0
  max: 2000
  label: "Wikipedia edit size (abs bytes)"
  unit: "B"
end

Component<LiveView> WikiEditsFeed
  endpoint: WikiEditsStream
  fields: ["user", "page_title", "action"]
  label: "Who is editing what (live)"
end
