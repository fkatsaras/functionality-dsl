// --- Server ----------------------------------------------------
Server SimpleJSON
  host: "localhost"
  port: 8080
  cors: "http://localhost:3000"
end

// --- External REST sources -------------------------------------
Source<REST> RealObjects
  url: "https://api.restful-api.dev/objects"
  verb: GET
  response:
    schema: RealObjectsRaw
end

Source<REST> RealObjectById
  url: "https://api.restful-api.dev/objects/{objectId}"
  verb: GET
  response:
    schema: RealObjectDetail
end

// --- Entities ---------------------------------------------------
// Example upstream JSON (GET /objects):
// [
//   {
//     "id": "1",
//     "name": "Apple MacBook Pro 16",
//     "data": { "color": "silver", "capacity": "1TB", "price": 3000, "year": 2023 }
//   },
//   ...
// ]

Entity RealObjectsRaw
  attributes:
    - raw: array = RealObjects;
end

Entity RealObjectsRows(RealObjectsRaw)
  attributes:
    - rows: array = map( RealObjectsRaw.raw, x ->
        {
          "id": x["id"],
          "name": x["name"],
          "color": x["data"]["color"],
          "capacity": x["data"]["capacity"],
          "price": x["data"]["price"],
          "year": x["data"]["year"]
        }
      );
end

// For a single item view (GET /objects/{objectId})
Entity RealObjectDetail
  attributes:
    - id: string = RealObjectById["id"];
    - name: string = RealObjectById["name"];
    - color: string = RealObjectById["data"]["color"];
    - capacity: string = RealObjectById["data"]["capacity"];
    - price: number = RealObjectById["data"]["price"];
    - year: integer = RealObjectById["data"]["year"];
end

// --- Internal endpoints -----------------------------------------
APIEndpoint<REST> RealObjectsList
  path: "/api/objects"
  verb: GET
  response:
    schema: RealObjectsRows
end

APIEndpoint<REST> RealObjectDetails
  path: "/api/objects/{objectId}"
  verb: GET
  response:
    schema: RealObjectDetail
end

// --- Components -------------------------------------------------
Component<Table> ObjectsTable
  endpoint: RealObjectsList
  columns:
    - "id": string
    - "name": string
    - "color": string
    - "capacity": string
    - "price": number
    - "year": integer
end

Component<ObjectView> ObjectDetailsCard
  endpoint: RealObjectDetails
  fields: ["id", "name", "color", "capacity", "price", "year"]
  label: "Object Details"
end
