// ------------------- Server -------------------
Server BinanceWS
  host: "localhost"
  port: 8080
  cors: "http://localhost:3000"
end

// ------------------- External WebSocket ----------------
Source<WS> BTCUSDT
  channel: "wss://stream.binance.com:9443/ws/btcusdt@ticker"
  publish:
    schema: BTCRaw
end

// ------------------- Raw Entity (snapshot from WS) ----------------
Entity BTCRaw
  attributes:
    - c: number = BTCUSDT["c"];  // last price in string number at key "c"
end

// ------------------- Computed Entity -------------------
Entity Prices(BTCRaw)
  attributes:
    - tick: object = { "t": now(), "btc": BTCRaw.c };
end

// ------------------- Internal endpoint ---------
APIEndpoint<WS> PricesStream
  path: "/api/prices"
  publish:
    schema: Prices
end

// ------------------- Component (bound to internal endpoint) -------
Component<LineChart> BitcoinPrice
  endpoint: PricesStream
  rows: data.tick
  seriesLabels: ["BTC Price"]
  xLabel: "Time"
  yLabel: "USDT"
end
