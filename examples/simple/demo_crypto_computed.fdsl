// ------------------- Server -------------------
Server BinanceWS
  host: "localhost"
  port: 8080
  cors: "http://localhost:3000"
end

// ------------------- External WebSocket sources ----------------
ExternalWS BinanceBTCMini
  url: "wss://stream.binance.com:9443/ws/btcusdt@miniTicker"
  protocol: "json"
end

ExternalWS BinanceETHMini
  url: "wss://stream.binance.com:9443/ws/ethusdt@miniTicker"
  protocol: "json"
end

// ------------------- Raw WS entities ---------------------------
Entity BTCMini
  source: BinanceBTCMini
  attributes:
    - c: float   // last price
    - o: float   // open
    - h: float   // high
    - l: float   // low
end

Entity ETHMini
  source: BinanceETHMini
  attributes:
    - c: float
    - o: float
    - h: float
    - l: float
end

// ------------------- Computed streaming entity -----------------
Entity PriceGap
  inputs:
    - b: BTCMini
    - e: ETHMini
  attributes:
    - time: int   = now()
    - gap: float  = abs(float(b.c) - float(e.c))
  where: self.gap >= 100
end

// ------------------- Internal endpoint -------------------------
InternalWS PriceGapStream
  entity: PriceGap
  path: "/api/price-gap"
end

// ------------------- Component (UI) ----------------------------
Component<LineChart> BitcoinPrice
  endpoint: PriceGapStream
  x: data.time
  y: [data.gap]
  xLabel: "Time"
  yLabel: "USDT"
end
