# Auto-generated models.py
from __future__ import annotations

from pydantic import BaseModel, ConfigDict, Field, field_validator
from typing import Optional, Any, List, Dict
from datetime import datetime, date, time
from uuid import UUID

{% if additional_imports %}
{% for imp in additional_imports %}
{{ imp }}
{% endfor %}
{% endif %}

{% for ent in entities %}
class {{ ent.name }}(BaseModel):
    """Generated Pydantic model for {{ ent.name }}."""

    {% for attr in ent.attributes %}
    {% if attr.field_constraints %}
    {{ attr.name }}: {{ attr.py_type }} = Field({% for key, value in attr.field_constraints.items() %}{{ key }}={{ value }}{% if not loop.last %}, {% endif %}{% endfor %})
    {% else %}
    {# Add default None for Optional fields to make them truly optional in Pydantic v2 #}
    {% if attr.py_type.startswith('Optional[') %}
    {{ attr.name }}: {{ attr.py_type }} = None
    {% else %}
    {{ attr.name }}: {{ attr.py_type }}
    {% endif %}
    {% endif %}
    {% endfor %}

    {% if ent.strict %}
    model_config = ConfigDict(extra="forbid")
    {% else %}
    model_config = ConfigDict(extra="ignore")
    {% endif %}

{% endfor %}

{% if models_needing_rebuild %}
# Rebuild models with forward references to resolve self-referencing types
{% for model_name in models_needing_rebuild %}
{{ model_name }}.model_rebuild()
{% endfor %}
{% endif %}

{% if crud_schemas %}
# ========================================================================
# CRUD SCHEMAS (Generated from entity exposure configuration)
# ========================================================================

{% for schema in crud_schemas %}
class {{ schema.name }}(BaseModel):
    """{{ schema.operation | capitalize }} schema for {{ schema.base_entity }}."""

    {% for attr in schema.attributes %}
    {% if attr.field_constraints %}
    {{ attr.name }}: {{ attr.py_type }} = Field({% for key, value in attr.field_constraints.items() %}{{ key }}={{ value }}{% if not loop.last %}, {% endif %}{% endfor %})
    {% else %}
    {% if attr.py_type.startswith('Optional[') %}
    {{ attr.name }}: {{ attr.py_type }} = None
    {% else %}
    {{ attr.name }}: {{ attr.py_type }}
    {% endif %}
    {% endif %}
    {% endfor %}

    model_config = ConfigDict(extra="forbid")

{% endfor %}
{% endif %}
