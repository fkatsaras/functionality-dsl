from fastapi import APIRouter, HTTPException
import httpx

router = APIRouter(prefix="/api/external/{{ endpoint.name | lower }}", tags=["{{ endpoint.name }}"])

@router.{{ endpoint.verb.lower() }}("/")
async def proxy_{{ endpoint.name | lower }}():
    async with httpx.AsyncClient() as client:
        response = await client.request("{{ endpoint.verb }}", "{{ endpoint.url }}")
        if response.status_code >= 400:
            raise HTTPException(status_code=response.status_code, detail=response.text)
        try:
            return response.json()
        except ValueError:
            return {"data": response.text}