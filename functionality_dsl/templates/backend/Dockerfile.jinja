FROM python:3.11-slim

WORKDIR /app
RUN pip install --no-cache-dir --upgrade pip

COPY pyproject.toml ./
# you may replace this with requirements.txt if needed
RUN python - <<'PY'
import tomllib, subprocess, sys
with open('pyproject.toml','rb') as f:
    d = tomllib.load(f)
    deps = d['project']['dependencies']
    subprocess.check_call([sys.executable, '-m', 'pip', 'install', '--no-cache-dir', *deps])
PY
COPY app ./app

EXPOSE {{ server.port }}
CMD ["uvicorn", "app.main:app", "--host=0.0.0.0", "--port={{ server.port }}"]